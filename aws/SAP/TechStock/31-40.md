# Techstock

## 31.

- DynamoDB:

  - WCU(Writing Capacity Unit): 書き込みキャパシティーユニット
  - RCU(Reading Capacity Unit): 読み込みキャパシティーユニット
  - Amazon DynamoDB Accelerator(DAX): 読み込み負荷がかかるワークロードで 1 秒あたり 100 万回単位のリクエストの応答時間をミリ秒とする。

- バックアップ&リストア:
  - バックアップを別リージョンに退避し必要あればリストア
- パイロットライト:
  - 平常時は停止した状態で環境を用意し、非常時に起動
  - DB Server
  - AMI
  - ![Screenshot 2023-06-28 at 6 45 05](https://github.com/yoshikikasama/network-and-server/assets/61643054/f5df0449-f65c-4be6-8878-52f7d2ebf231)
- ウォームスタンバイ:
  - 平常時は最小限のリソースで起動し非常時にスケール
- マルチサイト:
  - 常時、複数リージョンを使ってサービスを提供
- ![Screenshot 2023-06-28 at 6 27 49](https://github.com/yoshikikasama/network-and-server/assets/61643054/2fc1417b-cec2-4a05-914d-7fded7730e33)
- アクティブ/パッシブ(フェイルオーバー):

  - プライマリリソースまたはリソースグループをほとんどの時間で利用可能にして、すべてのプライマリリソースが使用できなくなった場合に備えて、セカンダリリソースまたはリソースグループをスタンバイ状態にします。クエリへの応答で Route53 が返すのは、プライマリリソースのみで、すべてのリソースで異常が発生した場合、Route53 は DNS クエリへの応答として正常なセカンダリリソースのみを返します。

- Redis と Memcached の比較：

  - https://aws.amazon.com/jp/elasticache/redis-vs-memcached/
  - ![Screenshot 2023-06-28 at 6 49 17](https://github.com/yoshikikasama/network-and-server/assets/61643054/f9222bf6-6241-4f70-8533-e18a8d2fc10b)

- 伝播: ルート情報がネットワーク内で広まることを指します。具体的には、ルーターやネットワークデバイス間で経路情報が共有され、ネットワーク上の他のデバイスがその情報を知ることができるようになります。オンプレミスネットワークから AWS Direct Connect を介して接続する場合、BGP を使用してオンプレミスネットワークの特定のルート情報（目的地ネットワークに対する経路）を AWS Direct Connect のお客様のルーター上で伝播（共有）することが必要です。

- CloudFront の署名付き URL:

  - 信頼された署名者: distribution の署名付き URL および署名付き Cookie を作成できる AWS アカウント。デフォルトでは許可されていないので、AWS アカウントを distribution に追加する必要があります。
  - コンテンツにアクセスできるユーザーを制御
  - 次のような場合は、署名付き URL を使用します。
    - 個別のファイル (アプリケーションのインストールダウンロード) へのアクセスを制限する場合。
    - ユーザーが Cookie をサポートしていないクライアント (カスタム HTTP クライアントなど) を使用している場合。
  - 次のような場合は、署名付き Cookie を使用します。
    - 複数の制限されたファイル (HLS 形式の動画のすべてのファイルやウェブサイトの購読者の領域にあるすべてのファイルなど) へのアクセスを提供する場合。
    - 現在の URL を変更したくない場合。

- SCP の効果をテストする:

  - AWS では、SCP を組織のルートにアタッチする前に、そのポリシーがアカウントに与える影響を詳細にテストすることが強く推奨されます。代わりに、お客様のアカウントを一度に 1 つずつ、または少なくとも少人数ずつ移動できる OU を作成し、誤って主要なサービスからユーザーを締め出すことのないようにします。

- Amazon EMR: 1 秒あたりの課金になる。コストとパフォーマンスを実現させるためには、スポットインスタンスの数を増やす。

- フォワードプロキシサーバー:

  - 内部ユーザーおよびサーバーからの要求の仲介者として機能し、後続の要求を高速化するためにコンテンツをキャッシュする。
  - 企業は通常、URL および Web コンテンツのフィルタリング、IDS / IPS、データ損失防止、監視、および高度な脅威防御を提供するためのプロキシソリューションを実装しています。
  - AWS ユーザーは、VPN または AWS Direct Connect 接続を使用して既存の企業プロキシサーバーインフラストラクチャを活用したり、内部 Elastic Load Balancing (ELB) を備えた Squid プロキシサーバーなどのソフトウェアを使用して AWS 上にフォワードプロキシファームを構築したりします。

- AMI: 15 分以内起動可能
- 起動テンプレート: 15 分以内不可能。

- 組織のアカウントで、リザーブドインスタンスの共有がオンになっている場合:
  - リザーブドインスタンスを購入した元のアカウントに、最初に割引が適用されます。購入アカウントに、リザーブドインスタンスの条件に一致するインスタンスがない場合、リザーブドインスタンスの割引は、組織の別のアカウントの一致する使用状況に対して適用されます。
  - 割引がマスター支払いアカウントの請求書に適用されるためには、組織の一括請求ファミリーの少なくとも 1 つのアカウントが、リザーブドインスタンスの仕様に一致する必要があります。
- 組織のアカウントで、リザーブドインスタンスの共有がオフになっている場合
  - リザーブドインスタンスの割引は、リザーブドインスタンスを購入したアカウントにのみ適用されます。
  - 組織の一括請求ファミリーの他のアカウントからのリザーブドインスタンスの割引は適用されません。
  - アカウントで蓄積した料金は、引き続き組織の一括請求に追加され、マスター支払いアカウントによって支払われます。

## 33.

- S3 のタイプ

  - STANDARD: 複数箇所にデータを複製するため耐久性が高い。頻繁に利用するデータを大量に保存するのに向いている。
  - STANDARD-IA: IA は Infrequency Access の略であり、低頻度アクセスデータ用のストレージ。STANDARD に比べて安価だが、One-Zone-IA より高い。
  - One-Zone-IA: 高頻度と低頻度の二つのアクセス階層を利用し、アクセスがあるファイルは高頻度(標準クラス)に維持しつつ、アクセスがないファイルは低頻度(標準 IA クラス)に自動で移動する。単一アベイラビリティーゾーンに保存。
  - S3 Glacier Flexible Retrieval: 柔軟に取得できる。1 年に 1~2 回アクセスされ、非同期で取り出されるアーカイブデータ向け。
  - S3 Glacier Instant Retrieval: 瞬時に取得できる。アクセスされることがほとんどなく、ミリ秒単位の取り出しが必要な長期間有効なデータ向け。
  - S3 Glacier Deep Archive: 長期記録。最安のアーカイブストレージ。7~10 年以上保持される長期間使用されるものの、めったにアクセスされないデータ向け。
  - 参考：https://aws.amazon.com/jp/s3/storage-classes/

- AWS Organizations: 複数の AWS アカウントを効率的に管理・統制するためのサービス。

  - 新しい AWS アカウントを作成しリソースを割り当てる
  - AWS アカウントをグループ化して整理
  - AWS アカウントまたはグループに統一されたポリシーを適用
  - すべての AWS アカウントに単一の支払い方法を利用することで請求を簡素化
  - OU(Organization Unit): 組織単位。組織内にある複数 AWS アカウントのグループ。
  - SCP(Service Control Policy): AWS アカウントまたはグループに統一されたポリシーを適用するための機能です。
    - 「SCP と IAM で明示的に許可され」なおかつ「いずれでも明示的に拒否されていない」場合に権限を有していると評価されます。
    - 「ざっくりとした」制限を SCP で実施し、細かい制御を IAM で実施する、というアプローチが適切かと思います。
  - 組織の証跡: OU を作成した場合に、その OU 内の全 AWS アカウントの全イベントを記録する証跡を作成できる。
  - 利用可能な機能セット:
    - 全ての機能: 一括請求機能も含む、高度なアカウント管理機能。SCP を使用できる。
    - 一括請求機能: OU 内のアカウント管理を一元化する基本的な機能。SCP を使用できない。
  - ![Screenshot 2022-11-23 at 9 33 50](https://user-images.githubusercontent.com/61643054/203450104-8b13678e-2e1a-4ec7-96ff-e481e872cebd.png)
  - ![Screenshot 2022-11-23 at 9 36 24](https://user-images.githubusercontent.com/61643054/203450125-6d282f87-1410-4c32-9d0c-98d34389fbc7.png)

## 34.

- Blue-Green Deployment: 異なるバージョンのアプリケーションを実行する環境をそれぞれ 1 つずつ、つまり計 2 つ作成し、それらの環境間でトラフィックを移動（ブルー ⇒ グリーンへ移動）させることによって、アプリケーションの新バージョンをリリースするために利用される技術です。
- Elastic Beanstalk を使用した Blue-Green Deployment: 個別の環境に新しいバージョンをデプロイしてから、2 つの環境の CNAME を入れ替えて、直ちに新しいバージョンにトラフィックをリダイレクトします。
- Amazon S3 のリクエスタ支払い: リクエストおよびバケットからのデータのダウンロードにかかるコストは、所有者でなくリクエストを実行したリクエスタが支払います。データの保管にかかるコストは常にバケット所有者が支払います。

- AWS Systems Manager Patch Manager:
  - OS とアプリケーションの両方にパッチを自動化できる。
  - そのために AWS Systems Manager Agent を EC2 インスタンスにインストールして設定する。

## 35.

- AWS Firewall Manager: AWS Organizations のアカウント間で AWS WAF ルールを一元管理するためのサービス。
- AWS Firewall Manager のオートメーションソリューション: AWS Organizations のすべてのアカウントとリソースでファイアウォールルールを一元的に設定、管理、監査できます。

- Auto Scaling グループのプロセス:

  - AZRebalance: グループ内の EC2 インスタンス数のバランスが悪くなったとき (それまで使用できなかったアベイラビリティーゾーンが正常状態に戻ったときなど) に、指定されたすべてのアベイラビリティーゾーン全体でグループ内のインスタンス数のバランスを整えます。

- Lambda@Edge 関数をトリガーできる CloudFront イベント:
  - CloudFront ディストリビューションの各キャッシュ動作に、特定の CloudFront イベントの発生時に Lambda 関数を実行させるトリガー (関連付け) を 4 つまで追加できます。
    Lambda@Edge でセッションの有効期限で安全な Cookie トークンを維持することでユーザーを認証および承認し、複数リージョンでの UX を向上させる。
  - ビューワーリクエスト: CloudFront がビューワーからリクエストを受け取ると、リクエストされたオブジェクトが CloudFront キャッシュにあるかどうかを確認する前に関数が実行されます。
  - オリジンリクエスト: CloudFront がリクエストをオリジンに転送したときにのみ、関数が実行されます。リクエストされたオブジェクトが CloudFront キャッシュ内にある場合、関数は実行されません。
  - オリジンレスポンス: CloudFront がオリジンからのレスポンスを受け取った後、レスポンス内のオブジェクトをキャッシュする前に関数が実行されます。関数は、オリジンからエラーが返された場合でも実行されることに注意してください。
  - ビューワーレスポンス: リクエストされたファイルがビューワーに返される前に関数が実行されます。ファイルが CloudFront キャッシュ内に既に存在するかどうかに関係なく、関数が実行されることに注意してください。
  - ![Screenshot 2023-07-16 at 9 49 53](https://github.com/yoshikikasama/network-and-server/assets/61643054/d7800309-ade2-4434-81ea-cb3e8ab3c7c0)

## 36.

- AWS WAF:

  - AWS WAF と API Gateway: AWS WAF は許可された IP アドレスのみにアクセスを制限するために web ACL と API Gateway に統合することができる。
  - レートベースのルールステートメント: 各発生元 IP アドレスからのリクエストのレートを追跡し、レートが制限を超えると、IP に対するルールアクションをトリガーし、制限は 5 分間あたりのリクエスト数として設定する。このルールにより過剰なりクエストを送信している IP アドレスからのリクエストを一時的にブロックする。

- ラウンドロビン: 複数の主体や対象を順繰りに（同じ順序で循環的に）指名したり割り当てたりすることを指す。
- ELB のスティッキーセッション機能: 同じユーザーからきたリクエストを全て、同じ EC2 インスタンスに送信する機能。

- Amazon DynamoDB グローバルテーブル:
  - マルチリージョンにマルチアクティブデータベースをデプロイするための完全マネージド型のソリューションです。
  - 独自のレプリケーションソリューションを構築および管理する必要はありません。
  - テーブルを利用したい AWS リージョンを指定すると、DynamoDB が進行中のデータ変更をそれらすべてに伝播します。
  - レプリカテーブル内の項目に加えられた変更は、同じグローバルテーブル内の他のすべてのレプリカにレプリケートされます。
  - グローバルテーブルでは、新しく書き込まれた項目は通常、1 秒以内にすべてのレプリカテーブルに伝播されます。グローバルテーブルでは、各レプリカテーブルには同じデータ項目のセットが保存されます。
  - DynamoDB では、一部の項目のみの部分的なレプリケーションはサポートされていません。
  - アプリケーションは、任意のレプリカテーブルとの間でデータを読み込みおよび書き込みできます。アプリケーションが結果整合性のある読み込みのみを使用し、1 つの AWS リージョンに対して読み込みのみを発行する場合、変更を加えずに動作します。
  - ただし、アプリケーションで強力な整合性のある読み込みが必要な場合は、同じリージョンですべての強力な整合性のある読み込みと書き込みを実行する必要があります。DynamoDB は、リージョン間での強力な整合性のある読み込みをサポートしていません。したがって、あるリージョンに書き込んで別のリージョンから読み込む場合、読み込みの応答には、他のリージョンで最近完了した書き込みの結果を反映していない古いデータが含まれる可能性があります。

## 37.

- Amazon CloudWatch Synthetics:

  - スケジュールに沿って実行される設定可能なスクリプトである Canary を作成し、エンドポイントと API をモニターリングできます。Canary は顧客と同じルートをたどり、同じアクションを実行します。これにより、アプリケーションに顧客トラフィックがない場合でも、顧客エクスペリエンスを継続的に検証できます。Canary を使用すると、顧客が問題を検出する前に問題を検出できます。
  - Canary はエンドポイントの可用性とレイテンシーをチェックし、読み込み時間のデータと UI のスクリーンショットを保存できます。REST API、URL、ウェブサイトのコンテンツをモニターリングし、フィッシング、コードインジェクション、およびクロスサイトスクリプティングによる不正な変更をチェックできます。

- AWS Schema Conversion Tool (AWS SCT):

  - データベースエンジン間で既存のデータベーススキーマを変換できます。リレーショナル OLTP スキーマやデータウェアハウススキーマを変換できます。変換されたスキーマは、Amazon Relational Database Service (Amazon RDS) MySQL、MariaDB、Oracle、SQL Server、PostgreSQL DB、Amazon Aurora DB クラスター、または Amazon Redshift クラスターに適しています。
  - AWS SCT を使用してデータベース移行評価レポートを作成できます。このレポートを使用すると、スキーマ変換タスクの概要やターゲットデータベースに自動的に変換できない項目の詳細を取得できます。この報告書を使用すると、を使用してプロジェクトをどのくらいを完了できるか、評価できます。

- AD Connector:
  - 既存のオンプレミスの Active Directory を AWS に接続するのに役立ちます。AD Connector は、ディレクトリ要求をオンプレミスの Microsoft Active Directory にリダイレクトできるディレクトリゲートウェイです。
- AWS SSO を Active Directory の自己管理型ディレクトリに接続:

  - Active Directory (AD) の自己管理型ディレクトリのユーザーも、AWS SSO ユーザーポータルで AWS アカウントやクラウドアプリケーションに SSO アクセスすることが可能です。そのために、AWS Directory Service では、以下の 2 つのオプションが用意されています。
    - 双方向の信頼関係を作成する:
      - AWS Managed Microsoft AD と AD の自己管理型ディレクトリの間に双方向の信頼関係が作成されると、AD の自己管理型ディレクトリのユーザーは、企業の認証情報を使用してさまざまな AWS サービスやビジネスアプリケーションにサインインできるようになります。一方的な信頼は、AWS SSO では機能しません。AWS Single Sign-On は、ユーザーとグループのメタデータを同期するために、ドメインからユーザーとグループの情報を読み取る権限を持つように、双方向の信頼が必要です。AWS SSO は、権限セットやアプリケーションにアクセスを割り当てる際に、このメタデータを使用します。ユーザーとグループのメタデータは、他のユーザーまたはグループとダッシュボードを共有するときなど、コラボレーション用のアプリケーションでも使用されます。
      - AWS Directory Service for Microsoft Active Directory → お客様のドメインへの信頼 = AWS SSO が認証のためにお客様のドメインを信頼することを許可
      - お客様のドメインへの信頼 → AWS Directory Service for Microsoft Active Directory = ユーザーとグループのメタデータを読み取るための AWS の権限を付与
    - AD Connector を作成する:
      - AD Connector は、クラウドに情報をキャッシュすることなく、ディレクトリ要求を自己管理 AD にリダイレクトできるディレクトリゲートウェイである。

- Amazon Workspaces:
  - ![Screenshot 2023-07-16 at 14 42 57](https://github.com/yoshikikasama/network-and-server/assets/61643054/593a2f76-8855-43fa-b774-1dbdb41a6759)
  - ![Screenshot 2023-07-16 at 14 54 11](https://github.com/yoshikikasama/network-and-server/assets/61643054/72f242f6-dd92-4852-b395-9304dc8880d7)
- AWS Directory Service: フルマネージド型のディレクトリサービス
  - AWS 上にスタンドアロンのディレクトリを新規に作成
  - 既存の Active Directory 認証との連携も可能
  - WorkSpaces は、AWS Directory Services をユーザ認証ディレクトリとして利用する。
  - AWS Managed Microsoft AD (MSAD): Microsoft Active Directory(AD) をマネージドサービスで実行
  - Simple AD : Samba 4 を使用する Microsoft Active Directory(AD) 互換のマネージド型ディレクトリ
  - AD Connector: オンプレミスの Microsoft Active Directory ヘリクエストをリダイレクトするディレクトリゲートウェイ
  - ![Screenshot 2023-07-16 at 15 03 58](https://github.com/yoshikikasama/network-and-server/assets/61643054/87478266-f498-448e-ad9a-0fff94ea7d43)

## 38.

- Amazon EC2 Auto Scaling のライフサイクルフック: Auto Scaling Group にライフサイクルフックを追加する機能を提供する。これらのフックにより、Auto Scaling インスタンスライフサイクルのイベントを認識し、対応するイベントが発生したときにカスタムアクションを実行するソリューションを作成できる。

- AWS IAM Identity Center: 昔の AWS SSO。複数 AWS アカウントの IAM を統一的に管理できる。
- AWS Organizations で AWS IAM Identity Center を利用する場合: すべての機能の有効化と AD Connector での企業の AD への接続が必要。

- Transit Gateway の複数 AWS アカウントでの共有: VPC を Transit Gateway にアタッチすることで異なるアカウント間でのリソースアクセスが可能となる。

- AWS Transfer Family:
  - インターネット経由でアクセス可能な VPC エンドポイントとして機能。既存の EIP をエンドポイントに提供できる。
  - セキュリティグループをエンドポイントに関連づけることができる。

## 39.

- S3 Replication Time Control (S3 RTC) : データレプリケーションに関するコンプライアンス要件 (またはビジネス要件) への対応をサポートします。また、Amazon S3 レプリケーション時間を可視化します。S3 RTC は、Amazon S3 にアップロードしたほとんどのオブジェクトを数秒でレプリケートし、これらのオブジェクトの 99.99% を 15 分以内にレプリケートします。S3 RTC を使用すると、まれなケースとして、オブジェクトが 15 分以内にレプリケートされなかったとき、またこれらのオブジェクトが 15 分のしきい値の後にレプリケートされたときに、Amazon S3 イベントから通知を受け取ることができます。Amazon S3 イベントは、Amazon SQS、Amazon SNS、または AWS Lambda.を通じて利用できます。

- S3 Bucket 同期の使い分け:

  - 同期ロジックが必要 → 独自実装
  - 既存オブジェクトの同期 → S3 Batch Replication
  - 継続的同期 → S3 Replication

- AWS Compute Optimizer: 使用パターンに基づいてコストを削減し、パフォーマンスを向上させることができる推奨事項を提供するのに役立つ。Amazon CloudWatch エージェントのインストールを必要とする。

- AWS Organizations を使用してメンバーアカウントを作成した後、そのアカウントにアクセスする方法:

  - AWS Organizations では新しいメンバーアカウント作成時に自動的に OrganizationAccountAccessRole が作成される。このロールを引き受けることで管理アカウントから新しいメンバーアカウントにセキュアにアクセスし、IAM User を設定することができる。

- IAM データベース認証: 各システム管理者のロールに IAM Policy をアタッチして、ロールをデータベースのユーザー名にマッピングする。AWS CLI を使用して、DB 接続時に使用される認証 token を生成する。
- ユーザーまたはロールに DB クラスターへの接続を許可するには、IAM ポリシーを作成する必要があります。その後、ポリシーをアクセス許可セットまたはロールにアタッチします。
- 次のポリシー例では、ユーザーは IAM データベース認証を使用して、DB ​ クラスターに接続できます。

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["rds-db:connect"],
      "Resource": [
        "arn:aws:rds-db:us-east-2:1234567890:dbuser:cluster-ABCDEFGHIJKL01234/db_user"
      ]
    }
  ]
}
```
