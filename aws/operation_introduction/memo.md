# AWS 運用入門

## 入門

- 機能要件：システムを使って業務を実行するためのアプリケーション機能やデータそのものの要求を示す。
- 非機能要件：「障害発生によりシステムが停止した場合は 3 時間以内に復旧して欲しい」など業務を安定的に稼働させるためのシステムの維持管理の方針やシステムに対するパフォーマンス要求を示す。

- VPC で使用する IP アドレスの CIDR ブロックは/16 から/28 まで指定できる。

  - RFC1918 に記載されている private ip address 範囲内の CIDR ブロックの使用を推奨している。もし範囲外で VPC を指定するとインターネット内の global ip と重複してサーバーなどと通信できなくなる可能性がある。
  - 10.0.0.0 ~ 10.255.255.255(10.0.0.0/8)
  - 172.16.0.0 ~ 172.31.255.255(172.16.0.0/12)
  - 192.168.0.0 ~ 192.168.255.255(192.168.0.0/16)

- public subnet: インターネットゲートウェイへのルーティングがある
- private subnet: インターネットゲートウェイへのルーティングがない

- セキュリティグループ:
  - 適用範囲：EC2 など AWS リソースにアタッチして利用する仮想 firewall
  - 設定方法：許可した通信のみ通過
  - レスポンス通信：
    - ステートフル: サーバーへのリクエストとの通信(インバウンド)がセキュリティグループのルールで許可されていれば、レスポンスの通信(アウトバウンド)は明示的に許可しなくても通信できる仕組み。
  - ルールの評価：全てのルールをチェックし通信拒否を判断する
- ネットワーク ACL:

  - 適用範囲：サブネットに対する仮想ファイアウォール。
  - 設定方法：拒否したい通信を設定できる
  - レスポンス通信：
    - ステートレス：サーバーへのリクエストの通信をネットワーク ACL のルールで許可していても、レスポンスの通信を明示的に許可しないといけない仕組み
  - ルールの評価：ルール番号の小さい順にチェックし、通信内容に合致するルールで通信可否を判断する

- ネットワーク ACL とセキュリティグループの使い分け:

  - ネットワーク ACL はゆるく制限し、セキュリティグループで厳しく制限すると管理しやすくなる。
  - ファイアウォールのルールを考える際、必要な通信だけ許可して、それ以外の通信は拒否するのが一般的ですが、ネットワーク ACL はステートレスのため、レスポンス通信を厳密に制御しようとするとエフェラルポートを考慮するため制限するポート数が増え、非常に大変。また、ネットワーク ACL はルール数が最大 40 までと制限されているため、全てのルールを入れることができなくなる。
  - そのため、たとえば web サーバーだけしかないときは、ネットワーク ACL をのインバウンドで「TCP80 番 port」を許可し、アウトバウンドは「全ての通信を許可」のように緩く制限し、各 EC2 インスタンスへの通信をセキュリティグループで細かく制限すると運用負荷を軽減して比較的安全に運用できる。
  - <img width="909" alt="Screenshot 2023-10-08 at 11 29 13" src="https://github.com/yoshikikasama/network-and-server/assets/61643054/58ebfee3-7018-4d7e-b41d-31b103cebccb">

- エフェメラルポート：通信時にクライアント側で一時的に利用されるポート番号(1024~ 65535)

## EC2 インスタンス

- t2.micro

  - t: 種別
  - 2: 世代
  - micro: インスタンスサイズ

- ENI(Elastic Network Interface): PC の LAN ケーブルの差し込み口のイメージ。AWS では ENI に EC2 の IP アドレスを紐づけてネットワーク通信を行う。

  - <img width="875" alt="Screenshot 2023-10-08 at 11 29 23" src="https://github.com/yoshikikasama/network-and-server/assets/61643054/5f552c76-eb5c-4e53-97c9-f3788fd0094b">

- EBS: ディスクサイズで課金される。
