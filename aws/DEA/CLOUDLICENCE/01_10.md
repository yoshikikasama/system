# CloudLicence

## 01.

- Apache Hive メタストア　 → 　 AWS Glue Data Catalog に移行できる。

- AWS Lambda と RDS のプライベート通信:

  - Lambda 関数にも RDS にも同じ SG を設定し、SG の設定で同じセキュリティグループからの通信を許可する。
  - Lambda 関数と RDS はどちらも同じ MySecurityGroup に所属しているため、この自己参照ルールにより、セキュリティグループに属するリソース間で安全に通信できるようになります。
  - セキュリティグループはデフォルトで全ての通信をブロックします。したがって、Lambda から RDS への通信が必要な場合は、「どこからの通信を許可するか」を明示的に設定する必要があります。自己参照ルールを設定しないと、同じセキュリティグループ内であっても、その通信は許可されません。
    - 例えば、RDS が使うポート 3306（MySQL の場合）へのアクセスを許可するためのルールを、送信元（ソース）として MySecurityGroup 自体を指定します。

- AWS Glue DataBrew: Excel のような GUI 上でデータを加工するサービス。
- Redshift Data API: Redshift にデータをロードするための手段を提供。リアルタイムデータアクセス可能。
- AWS Data Exchange: サードパーティーのデータセットを検索、購入、そして使用するためのサービスです。このサービスを利用することで、ユーザーは API 呼び出しを通じて簡単にデータセットにアクセスし、これを自身のアプリケーションや分析ツールと統合することができます。
- AWS DataSync: 主にオンプレミスと AWS 環境間、または AWS サービス間でのデータ転送を自動化するサービス
- Redshift Spectrum:
  - ![image](https://github.com/user-attachments/assets/1eceb24d-5d29-46ec-8a85-bde3a148603d)
- Apache Parquet 形式: 列指向フォーマットであり、必要な列のみに対して効率的にクエリを実行し、コスト効率が高い。Amazon Athena は列指向のクエリエンジンであり、Apache Parquet 形式のデータを使用すると、ファイル全体をスキャンする代わりに必要な列のみを読み込むことができます。これにより、データ転送量が削減され、クエリ実行時間が短縮されます。さらに、Parquet はデータの圧縮とエンコーディングをサポートしており、ストレージコストの削減にも寄与します。
- Apache Avro, csv : 行指向フォーマット。クエリが特定の列のみに対して実行される場合でも、ファイル全体をスキャンする必要がある。

## 02.

- Redshift 同時スケーリング:
  - 有効にすることで読み取りと香き込みのキャパシティを動的に拡張できます。具体的には、Amazon Redshift のワークロード管理（WLM）は、クラスター内のリソースを効率的に配分するための機能であり、キューレベルで同時実行スケーリングを有効にすることで、ユーザー定義のキューの待機時間が一定以上になった場合に、自動的に追加のコンピューティングリソースをプロビジョニングします。これにより、需要の変動に応じて読み取りと香き込みのキャパシティを自動で拡張し、クラスターのパフォーマンスを最適化することができます。この機能は、特に大規模なデータウェアハウス操作において、性能の向上とリソースの効率的な利用を実現します。
  - 同時実行スケーリングが有効になっている場合、Amazon Redshift は自動的に新たなクラスターキャパシティーを追加し、読み取りと書き込み両方でクエリの増加に対応します。クエリをメインクラスターと同時実行スケーリングクラスターのどちらで実行しても、ユーザーには最新のデータが表示されます。WLM キューを設定することで、どのクエリを同時実行スケーリングクラスターに送するかを管理できます。同時実行スケーリングを有効にすると、対象となるクエリはキュー内に待機することなく、同時実行スケーリングクラスターに送信されるようになります。
- Boto3 AWS Glue create_partition API: Amazon S3 にデータを書き込む際に Boto3 AWS Glue create_partition API を呼び出すことで、AWS Glue Data Catalog が S3 ストレージと即時に同期できます。これにより、データエンジニアは新しいパーティションが追加されるたびに手動で介入することなく、AWS Glue Data Catalog が常に最新の状態を保つことを保証できます。この方法は、レイテンシーを最小限に抑えることができます。

- AWS Glue ワークフロー: データの ETL（抽出、変換、ロード）プロセスを自動化し、管理するためのサービスであり、複数の ETL ジョブと前提条件を一つのワークフローとして組み合わせることができます。この機能により、Microsoft SQL Server からデータを抽出し、変換して Amazon S3 バケットにロードするプロセスを簡単に設定できます。さらに、データパイプラインの調整が必要な場合にも、AWS Glue ワークフローを使用することで、複雑なスクリプトや外部の調整ツールを用いずに、プロセスの管理と調塾を行うことができるため、コストと労力の両面で効率的です。AWS Glue では、ワークフローを使用して、複数のクローラ、ジョブ、トリガーが関与する複雑な ETL（抽出、変換、ロード）アクティビティを作成および視覚化できます。各ワークフローは、そのすべてのジョブとクローラーの実行と監視を管理します。ワークフローは各コンポーネントを実行すると、実行の進行状況とステータスを記録します。これにより、より大きなタスクの概要と各ステップの詳細が得られます。AWS Glue コンソールは、ワークフローをグラフとして視覚的に表現します。
- AWS Step Functions と Amazon Managed Workflows for Apache Airflow （Amazon MWAA）: 複数の AWS サービスや外部サービス間でのタスクの調整や自動化に特化したサービスです。これらのサービスは、ワークフローの管理やタスク間の依存関係の設定などを効率的に行うことができますが、データの ETL （抽出、変換、ロード）を直接実行する機能は持っていません。ETL プロセスを実行するには、AWS Glue や他のデータ処理サービスを組み合わせて使用する必要があります

- Amazon EBS: ボリュームタイプの変更はデータの複製や移行を伴わずにアップグレードできる。(例: gp2 → gp3)
- AWS Lake Formation:

  - [lake formation 説明](https://qiita.com/sot528/items/8a4c3adf9ba5c2da3fa9)
  - AWS でデータレイクを構築・運用するためのマネージドサービス
  - 実体は、ほぼ AWS の各種サービスをラップしたもの(Glue, IAM, S3, etc..)
  - データレイク専用にアクセス制御を行うために、IAM とは別に独自の権限管理機構を持つ
  - Lake Formation を使用して AWS アカウント間でピアツーピアのデータ共有を可能にします。

    - データ コンシューマーがデータセットへのアクセスを要求します。
    - データ所有者は、アクセス要求を承認することでアクセスを許可します。データ所有者は、アクセス要求の承認をデータ管理者に委任できます。
    - アクセス要求が承認されると、プロデューサー アカウントの Lake Formation 内の特定のデータセットに新しい権限が追加されます。

  - Amazon S3 のパスを AWS Lake Formation のロケーションとして登録することにより、データの組織化とアクセスの管理を効率化します。この方法により、データエンジニアリングチームは、必要なデータへのアクセスを正確に制御し、人事部門がそのリージョン内の従業員のみのレコードにアクセスできるようにすることができます。
  - データレイクへの Amazon S3 ロケーションの追加

    - Amazon S3 のロケーションをテータレイク内のストレージとして追加するには、そのロケーションを AWS Lake Formation に含録します。その後、Lake Formation のアクセス許可を使用して、この場所を指す AWS Glue データ カタログ オブジェクトと、その場所の基礎となるデータに対するきめ細かいアクセス制御を行うことができます。

  - AWS Lake Formation のきめ細かなアクセス制御を有効にすることで、各リージョンのデータに対するきめ細かなアクセス制御が可能になります。データフィルターを追加することで、各人事部門が自部門のリージョン内の従業貝レコードのみにアクセスできるように制限し、この要件を満たすために必要な運用上のオーバーヘッドを最小限に抑えることができます
  - ![image](https://github.com/user-attachments/assets/0d22378a-3372-4f4c-a4c8-8e89dfd742e7)
