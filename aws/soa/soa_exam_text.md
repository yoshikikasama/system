# soa 試験テキスト

## モニタリング、ロギング、修復

- ワークロード: AWS 上に構築されたシステム。
- メトリクス: AWS リソースの使用状況を収集し、数値化された時系列データセットのこと。
- CloudWatch: メトリクスのリポジトリ。
- CloudWatch エージェント: アプリケーションごとのメモリ使用率など、OS の内部で取得する必要のあるデータをカスタムメトリクスとして CloudWatch に収集する。
- CloudWatch Logs: ログの一元管理・検索・フィルター処理を行うサービス。
- AWS Config: AWS リソースの設置を記録して評価するサービス。
  - AWS Config ルール: AWS リソースの設定内容をチェックして、修復アクションの実行(AWS Systems Manager Automation)、SNS による通知を行う。

## 信頼性とビジネス継続性

- 信頼性: 障害に対して回避・維持・回復する能力。

- Auto Scaling: ターゲットに対してスケーリングを行うことが目的。
  - 手動スケーリング
  - スケジュールスケーリング
  - 動的スケーリング:
    - 簡易スケーリング: CPU 使用率が 50%を超えると EC2 インスタンスを 1 つ追加するなど。実行できることも少ないため、非推奨。
    - ステップスケーリング: CPU 使用率が 60~70%なら EC2 インスタンスを 1 つ追加、70~80%なら EC2 インスタンスを 2 つ追加など。
    - ターゲット追跡スケーリング: CPU 使用率 50%が目標値とすると、スケーリンググループ全体の CPU 使用率が 50%になるように自動的にスケールアウト/スケールインの調整がされる。
  - 予測スケーリング: 過去の CloudWatch のメトリクスを機械学習させてシステム負荷の動向を推測し、そのパターンに応じてスケーリングを行う。
  - スケーリング対象:
    - Amazon EC2 Auto Scaling Group
    - Amazon EC2 スポットフリートリクエスト
    - Amazon ECS
    - Amazon DynamoDB
    - Amazon Aurora
  - Auto Scaling Group: スケーリングに関するインスタンスを管理する論理的なグループ。インスタンス数の最小・最大・希望の台などを指定できる。
  - 起動テンプレート: Auto Scaling Group でスケールアウトが発生し、新たにインスタンスを作成するときの事前の設定。
- ELB: ターゲット(EC2、コンテナ、IP アドレス)のトラフィックを自動分散させる負荷分散サービス。単一リージョンのサービス。
  - ロードバランサー: 一意な FQDN(Fully Qualified Domain Name)を使って接続し、プロトコルとポートごとに各リスナーに振り分け。
  - リスナー: プロトコルとポート、ルールごとに振り分け。
  - ターゲットグループ: ターゲットとヘルスチェックを管理。
  - ヘルスチェック: ターゲットに対して設定したプロトコルでアクセスを行い正常にアクセスできるかをテストする操作。合格したインスタンスのみにリクエストがルーティングされる。
  - ALB: ターゲットへの通信は ALB 自身が行うため、ターゲットから見た接続元 IP は ALB になる。接続したユーザーの IP を確認したい場合は、X-Forwarded-For HTTP ヘッダーに接続元 IP が記録されているので、これをターゲット側で出力するようにする。また、ALB 自身にセキュリティグループを設定し、ターゲットのセキュリティグループに ALB のセキュリティグループを設定するとターゲットへの接続を ALB のみに制限し、外部から直接接続できなくする。
- NLB: UDP を扱うシステムや静的 IP でアクセスをしたい場合に最適。

- Route53 のヘルスチェック: システムのエンドポイントに対するヘルスチェック。複数のリージョンにあるシステムに対して可能。

- RDS: スタンバイレプリカとリードレプリカがある。
- Aurora: リードレプリカのみ。
- SQS のスケーリング: SQS の queue 数などを lambda で get metrics で取得し、cloudwatch に put metrics する。cloud watch アラームによって Auto Scaling で EC2 インスタンスをスケールアウトできる。
- 可用性: システムが使用できる状態を維持できる能力。
- 耐障害性: 障害が起きていてもシステムを維持できる能力。

- EC2 のマルチ AZ 化: Auto Scaling Group でネットワーク設定で複数の AZ を指定。
- ELB のマルチ AZ 化: ALB の場合は稼働させる AZ を 2 つ以上選択することによりマルチ AZ 構成となる。
- RDS のマルチ AZ 化: マルチ AZ 設定を行うと別の AZ に RDS スタンバイインスタンスが構築される。

- フォールトトレラント: コンポーネントの一部が故障してもシステムがパフォーマンスを落とすことなく動作し続ける能力。

- Route53 のルーティングポリシー: DNS の応答をカスタマイズすることでクライアントからのトラフィックを適したリソースへルーティングする機能。

  - シンプルルーティング: 1 つのリソースに複数の IP アドレスを設定可能。
  - 加重ルーティングポリシー: ドメインに対して複数のリソースを関連付けることができ、割合を決めることができる。
  - フェイルオーバールーティングポリシー: Route53 のヘルスチェックによりリソースが正常なほうへトラフィックをルーティング。
  - レイテンシールーティングポリシー: ネットワークレイテンシーが最も低い AWS リージョンに基づいてリクエストをルーティングできる。
  - 位置情報ルーティングポリシー: DNS リクエストを送信したユーザーの地理的な場所に基づいて名前解決の結果を変えること。
  - 地理的近接性ルーティングポリシー: クライアントだけでなく AWS リソース側の位置情報を考慮してルーティングすることが可能。

- RPO(Recovery Point Objective): 障害が発生した時にどの地点までのデータを復旧させるかの目標。 例えば RPO が 1 日であれば毎日 1 回 Backup を取得する。
- RTO(Recovery Time Objective): 障害発生時からどのくらいの時間でシステムを復旧させるかの目標。

- RDS スナップショット:
  - 自動スナップショット: 1 日 1 回スナップショット、5 分に 1 回トランザクションログを出力。
- AWS Backup: 様々な AWS リソースの backup リストを一元管理できるサービス。個々のサービスで行っていた backup、リストアの操作をまとめて管理できるようにしたもの。
  - EC2
  - DynamoDB
  - EBS
  - S3
  - RDS
  - Storage gateway
  - EFS
- AWS Backup Audit Manager: 全ての対象のリソースで毎日 Backup ができているか、その Backup が暗号化されているかなどを確認できる。
- AWS Data Lificycle Manager(DLM): EBS スナップショットと AMI の作成、保持、削除を自動化できる。backup に失敗した時に、設定した世代管理の数だけ直近の backup が残るが、明確に世代管理する必要がない場合は。AWS Backup で良い。
- データベースのリストア:

  - ポイントインタイムリストア: スナップショットと 5 分に 1 回のトランザクションログからリストア
  - リードレプリカの昇格: 5 分以下で、あれば瞬時にリストアできるリードレプリカの昇格を選択する。

- S3:
  - アクセスする側の権限: IAM ポリシー
  - アクセスされる側の権限: Bucket Policy, ACL
    - Bucket Policy: バケット単位でアクセス制限したい場合やクロスアカウントでの利用
    - ACL: Bucket Policy より弱い権限で、Bucket Policy が優先される。

## 展開、プロビジョニング、 オートメーション

- プロビジョニング: AWS の各種リソースの構築。
- AMI (Amazon Machine Image): ソフトウェア構成をイメージファイルとしてまとめることができる。サーバーのディスクである EBS に格納されるデータや構成情報も含まれている。

- AWS CloudFormation:
  - スタック: テンプレートファイルから作成されるリソースの集合。
  - 変更セット: CloudFormation の実行により理教を受けるリソースを事前に確認する機能。
  - ドリフト: コンソールとスタック リソースの差分を検出する機能。
- AWS CDK(AWS Cloud Development Kit): cfn テンプレートを TypeScript, Java, Python などのプログラミング言語から生成することができる。

- Blue/Green デプロイ: 新旧バージョンのアプリケーションを並存させ、ロードバランサーなどの機能でトラフィックを旧から新に切り替えること。

## セキュリティとコンプライアンス

- IAM ポリシー: AWS リソースへのアクセス権限をまとめたもの

  - Action: どのサービスの
  - Resource: どういう機能や範囲を
  - Effect: 許可または拒否

- GuardDuty: CloudTrail, VPC フローログ, DNS ログの 3 種類から悪意のあるログや IP や異常パターンなどを検出する。
- Amazon Detective: CloudTrail, VPC フローログ, GuardDuty の情報を受け取り分析する。Guard Duty で発見した問題の兆候をさらに詳細に深掘りする用途などで使う。

- SCP(Service Control Policy): AWS アカウントに対するポリシーという形でホワイトリスト/ブラックリスト形式で権限を管理する。上位で決めたポリシーは個々のアカウント単位で打ち消すことはできません。

- SAML2.0 を使用したフェデレーション:
  - 外部の認証機関を利用して AWS リソースにアクセス許可を与える方法として SAML2.0 を利用したフェデレーションがある。
  - SAML(Sercurity Assertion Markup Language)は複数の独立したシステムの間で認証要求や認証の可否の情報をやり取りするための仕様。
  - 外部の認証機関を利用する利点としては、組織内の認証管理の一元化ができることです。
  - Active Directory のような組織内の認証を一手に担う ID プロバイダーを用意することで、組織・利用者の認証に関する管理負荷を下げることができます。
  - AWS アカウントに対して SAML2.0 を使用したフェデレーション設定をする場合は IAM ロールのプリンシパルの設定で SAML プロバイダーとの信頼関係を設定する。
- AWS Directory Service:
  - Simple AD: Samba4 を使用した Microsoft Active Directory 互換のディレクトリサービスを構築。
  - AD Connector: Active Directory に対するプロキシのようなサービスで、オンプレミス上に構築済みの AD がある場合に AD Connector を経由して認証することができる。
  - AWS Manged Microsoft AD: Windows Server 2012 R2 で実行される AD ドメインサービスそのものを構築。
- Amazon Macie: 機械学習によるデータ分類、識別の自動化サービス。

- AWS Key Management Serivce(KMS): 暗号化キーの作成と管理を行うマネージドサービス。

  - エンベロープ暗号化: 暗号化の為に使用するキーをさらに別のキーで暗号化する仕組み。
  - Customer Data Key (CDK): 暗号化のために使用するキー。
  - Customer Master Key(CMK): CDK を暗号化するキー。

- ストレージの種類:

  - S3(オブジェクトストレージ): ファイルをオブジェクトとしてフラットな形式で保存する。
  - EBS(ブロックストレージ): データをブロック単位で分割して保存。サーバーのハードディスクなどに利用。
  - EFS(ファイルストレージ): ディレクトリとファイル構造を持つ形式でファイルを保存する。

- S3 の暗号化:
  - サーバーサイド暗号化: S3 にデータが到達した後、S3 側でデータの暗号化を行う方法。
    - Amason S3 キー(SSE-S3)
    - AWS KMS キー(SSE-KMS)
    - ユーザーが指定したキー(SSE-C): コンソールからは利用できず、AWS CLI, AWS SDK または S3 RESTAPI を使用する必要がある。
  - クライアントサイド暗号化: クライアント側でデータを暗号化して S3 にアップロードする方法。
- EBS の暗号化: EBS ボリュームとスナップショットのいずれも暗号化が可能。デフォルトの暗号化を強制することができる。
- EFS の暗号化: ファイルシステム作成時に暗号化するか選択できる。デフォルト暗号化の強制も可能。
- RDS の暗号化: インスタンスを新規作成する時のみ暗号化の設定が可能。
- ACM(AWS Certificate Manager): SSL/TLS で用いる証明書の発行と管理を行うマネージドサービス。

  - ELB: ELB に証明書を適用することで外部からのアクセスを SSL/TLS で暗号化することができる。
  - Amazon CloudFront: ディストリビューションに証明書を適用することで、CloudFront で配信されるコンテンツへのアクセスを暗号化する。

- AWS VPN(Virtual Private Network): インターネットを利用して仮想のプライベートネットワークを構築する技術。
  - AWS Site-to-Site VPN: オンプレミスと AWS の拠点間ネットワークを IPsec および VPN 接続する仕組み。オンプレミス側に VPN 接続のための機器(カスタマーゲートウェイ)を用意する必要がある。社内ネットワークと AWS を接続したい場合などに利用。
  - AWS クライアント VPN: AWS のネットワークやリソースに対して、各クライアントから TLS VPN セッションにより接続する仕組み。
    - 例えばリモートワークのようなケースで、社員が利用する端末に VPN クライアントとなるソフトをインストールすることで、各端末からの VPN 接続が可能になる。
  - 仮想プライベートゲートウェイ: VPC の出入り口としてオンプレミス環境と AWS 環境を繋ぐ
- Amazon Inspector: EC2 インスタンスの脆弱性を評価および検出するサービス。Amazon Inspector エージェントを EC2 インスタンスにインストールすることで EC2 の評価が可能。
- AWS Security Hub: AWS アカウントにおけるセキュリティの状態と、セキュリティのベストプラクティスに準拠しているかどうかを包括的に把握する機能を提供。

## ネットワークとコンテンツ配信

- サブネット作成時に指定した IP アドレス範囲の内、最初の 4 つ、最後の 1 つのアドレスは AWS に予約されているため、使用できない。
  - 例)サブネット 10.0.0.0/24 の時以下は使用禁止
    - 10.0.0.0/32
    - 10.0.0.1/32
    - 10.0.0.2/32
    - 10.0.0.3/32
    - 10.0.0.255/32
- VPC 内に複数の AZ を含むことができる。
- サブネットは AZ 単位で作成する必要がある。
- マルチ AZ 構成: 同じ役割を持ったサブネットを複数の AZ に配置し、EC2 などを各 AZ に冗長的に配置することで、AZ 障害を考慮した耐久性の高い設計にする。

  - 例)
    - AZ-A
      - public-subnet-a
      - private subnet-a
    - AZ-B
      - public-subnet-b
      - private subnet-b

- ルートテーブル:

  - メインルートテーブル: VPC に自動的に割り当てられるデフォルトのルートテーブル。
  - サブネットルートテーブル: サブネットに関連づけられたルートテーブル
  - ゲートウェイルートテーブル: インターネットゲートウェイまたは仮想プライベートゲートウェイに関連づけられたルートテーブル。
  - サブネット 1 つ 1 つにそれぞれルートテーブルを作成するのではなく、サブネット用途ごとにルートテーブルを 1 つ作成してその同じ用途のサブネットを関連づけることが一般的。

- VPC エンドポイント: 特殊な AWS のゲートウェイを経由してプライベート IP での通信で接続する方法。
  - インターフェースエンドポイント: VPC 内部に ENI(Elasitc Network Interface)が立ち上がり、その ENI と対象 AWS サービスのエンドポイントを AWS PrivateLink と呼ばれるものでリンクします。
  - ゲートウェイエンドポイント: 接続元のサブネットに紐づいているルートテーブルにエンドポイント向けのルートを追加することで S3 と DynamoDB の場合のみ VPC エンドポイントを経由してローカル通信で接続することが可能。
- VPC ピアリング: 2 つの VPC 間でプライベートな通信を行うための機能。同一 AWS アカウントや別 AWS アカウントも可能。

  - 互いの VPC のプライベート IP アドレスをそのまま利用する為、重複している IP アドレス範囲を持つ VPC 同士では VPC ピアリング設定できない。

- AWS Direct Connect: VPC とオンプレミス環境を AWS の専用線で接続できるサービス。
- AWS VPN: インターネットを介して VPC とオンプレミス環境間に安全な接続経路を構成する。

- AWS WAF: 通信の内容を確認し、ルールに基づいて許可/拒否を行う。SQL インジェクション、クロスサイトスクリプティングなどの攻撃に対するルールがある。
- AWS Shield: DDoS 攻撃からシステムを保護することができるサービス。

- Route53: ドメイン管理と権威 DNS 機能を持った DNS のマネージドサービス。DNS サービスが 53 番ポートを利用することから Route53。
  - 権威 DNS: ドメイン名と IP アドレスの変換情報を保持している DNS のこと。
  - ドメイン管理: 新規ドメインの取得や更新などの手続きができる。
  - ホストゾーン: ドメイン名ごとにまとめて管理可能なレコードのグループ。ホストゾーン内の全ての DNS レコードはホストゾーンのドメイン名を持っている。
    - 例) example.com
      - www.example.com
      - web.example.com
    - public ホストゾーン: インターネット上に公開された DNS にメインレコードを管理
    - private ホストゾーン: VPC 内に閉じたプライベートネットワーク内のドメインのレコードを管理。
    - A レコード: ドメイン名と IP アドレスの関連づけを定義するレコード
    - CNAME レコード: 正規ドメイン名に対する別名を定義するレコード
    - エイリアスレコード: Route53 固有の DNS 拡張機能で、ドメイン名と AWS リソースがデフォルトで持っている DNS 名の関連付けを定義することができるレコード。
  - Zone Apex: example.com などのドメイン名自体。
  - サブドメイン: www などを付与した。
- Amazon CloudFront: 静的データおよぼ動的データを高速に配信するための CDN(Content Delivery Network)です。

  - オリジンサーバー: コンテンツを格納しているサーバー
  - ユーザーとオリジンサーバーの間に位置し、転送すべきコンテンツを CloudFront がキャッシュをする。キャッシュのデータをレスポンスすることで高速配信する。
  - S3 Origin Access Identity(OAI): CloudFront に特別なユーザーを設定し、オリジンサーバーである S3 の Bucket Policy に OAI のみ読み取り可能という設定を行う。
  - [CloudFront の Cache Policy と Origin Request Policy を理解する](https://qiita.com/t-kigi/items/6d7cfccdb629690b8d29)
  - HTTP レスポンスの Cache-Control および Expires ヘッダーによって指定する
    - Cache-Control の max-age で何秒有効かを指定
    - Cache-Control で max-age がなく、 Expires が指定されている場合は Expires の期間まで有効であることを指定
    - 両方指定されている場合は max-age のみが有効
    - Cache-Control に no-cache , no-store , private ディレクティブが含まれる場合は 基本的に キャッシュしない
  - CloudFront の設定でレスポンスにこれらのヘッダの情報が含まれない場合、あるいは、範囲外になる数値を強制的に指定できる
    - つまり、 レスポンスでの指定を CloudFront の設定で上書きできる
    - CloudFront では TTL (Time To Live) で「コンテンツが何秒有効か」を指定する
    - Minimum TTL <= レスポンスで指定された生存期間 <= Maximum TTL であればそのまま利用
    - 範囲外であれば Minimum と Maximum の近い方に寄せられる
    - 指定がない場合は Default TTL が利用される
    - CloudFront の設定優先なので Minimum TTL > 0 の場合は Cache-Control に no-cache , no-store , private ディレクティブが含まれていても 設定優先でキャッシュする(!)
    - リクエストを元にして、キャッシュキーを生成する。キャッシュキーの生成手段を変更することで、上記の同一コンテンツのアクセスは同じものか、別のものかを区別できる。 コンテンツ ( /index ) だけを見てキャッシュキーを生成するのであれば、上記の 3 つは同じキーを生成するので同一のキャッシュ領域を共有するし、コンテンツ ( /index ) と X-Auth ヘッダの中身 (ヘッダがない場合は ""と等価とする) の 2 要素でキーを生成するようにすれば、「A, B」「C」でそれぞれ個別のキャッシュ領域を参照するようになる。

- セキュリティグループ:
  - 適用単位: サブネット単位(EC2, RDS ごとに適用される)
  - 制御する種類: 許可のみ
  - 戻りの通信の取り扱い: ステートフル(戻りの通信に対しては設計が不要となる)
  - 制御内容の指定方法: プロトコル、PORT,CIDR, セキュリティグループ
- ネットワーク ACL:

  - 適用単位: インスタンス単位(サブネット内の全 AWS サービスに適用)
  - 制御する種類: 許可/拒否
  - 戻りの通信の取り扱い: ステートレス(戻りの通信に対しても設計が必要)
  - 制御内容の指定方法: PORT,CIDR

- VPC フローログ:
  - S3 または CloudWatch に保存
  - ネットワークインターフェースに出入りするトラフィック
  - セキュリティグループとネットワーク ACL がトラフィックに対して行った許可、ブロックなどのアクション
  - VPC 内に到達しているトラフィック
- ELB のアクセスログ:

  - S3 に保存可能
  - リクエスト元のユーザーの接続元 IP アドレス
  - レスポンスの HTTP ステータスコード
  - ターゲットの応答からの HTTP ステータスコード
  - ロードバランサーが実行したアクション -　いつどのパスにどういったアクセスがあったか

- 一般的に Well Known Port(HTTPS: 443 など)のリクエストに対するレスポンスには、エフェメラルポート(1024~65535)が使用される。

## コストと最適化

- EC2:
  - M5.large
    - M: インスタンスファミリー
    - 5: 世代
    - large: インスタンスサイズ
- インスタンスファミリーの分類:
  - 汎用：用途の幅が広い、CPU・メモリのバランスが取れている。A, T, M。
  - コンピューティング最適化: メモリに比べて CPU の性能比率が高めに設定されている。C。
  - メモリ最適化: CPU に比べてメモリの搭載が高めに設定されている。R,X。
  - 高速コンピューティング: GPU や FPGA が搭載されている。P,G,F。画像処理が得意な P タイプ。機械学習が得意な G タイプ。
  - ストレージ最適化: ストレージ処理に特化した性能設定がされている。I,D,H。
- EBS 最適化オプション: EBS 専用のネットワークを用意するオプション。

- EC2 の主なメトリクス:

  - CPU 使用率: CPUUtilization
  - ネットワーク使用率: NetworkIn(受信 Bytes 数), NetworkOut
  - ディスクパフォーマンス: DiskReadOps, DiskWriteOps
  - ディスクの読み書き量: DiskReadBytes, DiskWriteBytes
  - メモリの使用率、ディスクスワップの使用率: CloudWatch エージェントを導入する。

- EBS ボリュームの種類:

  - SSD タイプ: ランダムアクセスに強く、秒間の読み込み回数の性能を示す IOPS が高い特徴。
  - HDD タイプ: データの並んだ順に読み込むシーケンシャルアクセスに強く、コスト面での優位性もある。
  - 種類:
    - 汎用 SSD ボリューム: 料金とパフォーマンスのバランスが良い標準的ボリューム。
    - Provisioned IOPS SSD: データベースなど低レイテンシー・高 IOPS が必要なユースケース向け。
    - スループット最適化 HDD: サイズの大きなデータ向け、細かいデータの連続読み込みには向かない。
    - Cold HDD: アクセス頻度が低いデータ向け。低コスト。

- EC2 のクラスタープレイスメントグループ:
  - クラスタ: 同一の AZ に配置。拡張ネットワーキングとの併用が望ましい。インスタンス間で低レイテンシー、高スループットなネットワーク性能。
  - パーティション: 起動するインスタンスのホスト・ラックを分散。ハードウェア障害の頻度を低減。ワークロードの相関障害の軽減など。
  - スプレッド: 複数 AZ に独自のネットワークおよび電源がある異なるラックにインスタンスを配置。ハードウェア障害の頻度を低減。各 EC2 インスタンスを個別に独立したハードウェアに配置する必要がある場合など。
- Amazon S3 Transfer Acceleration: 日本から海外リージョンなど、遠隔地の S3 に大量のデータを定期的に送信する要件がある場合に、CloudFront の最寄りのエッジポイントを経由して転送するオプションサービス。

## AWS のベストプラクティスに沿った設計と運用

- 運用上の優秀性:
  - 運用の自動化を支援する CloudFormation などを活用すること
  - 障害に備えてログ・メトリクスを収集・監視すること
  - システムリリースの品質を保証すること
- セキュリティ:
  - アイデンティティ管理とアクセス管理
  - 伝送中および保管中のデータの暗号化
  - 全レイヤーでの多層防御
  - セキュリティインシデント対応
- 信頼性:
  - 復旧手順をテストしておくこと
  - 障害からの自動復旧
  - スケーラブルなシステム
  - キャパシティ推測を不要に
  - 変更管理の自動化
  - バックアップと復元
- パフォーマンス効率:
  - 適切なリソースの選択
  - リソースの確認とモニタリング
  - トレードオフの判断
- コスト最適化:
  - リソースの需給の一致
  - インスタンス購入方法によるコスト削減
  - アーカイブストレージの活用
  - コストの把握
- サステナビリティ
  - エネルギー消費の削減

## AWS SOA 模擬試験

- AWS Organizations:

  - 一括請求機能: メンバーアカウントの請求管理のみを管理アカウントに統合。
  - 全ての機能: メンバーアカウントの請求管理以外の AWS リソースの権限管理なども管理アカウントに統合。

- CloudWatch Logs にログを送信するためには:

  - CloudWatch Logs の API を使用する権限
  - VPC エンドポイントまたはインターネット経由で CloudWatch Logs エンドポイントへの通信が必要。

- スポットフリート: スポットインスタンスをまとめて購入および管理するオプション。

- デフォルトの AWS 管理 CMK で暗号化された AMI を別アカウントに共有する場合の注意点:
  - デフォルトの AWS 管理 CMK で暗号化された AMI は別アカウントに共有できない為、共有先アカウントの権限を付与したカスタマー管理 CMK を指定して元の AMI をコピーすることで再暗号化した AMI を作成してから共有する。スナップショットの暗号化に使用された KMS キーの使用を共有先 AWS アカウントに許可する必要があります。
- Amazon EC2 インスタンスを別のアカウントの別のリージョンに移行する方法:

  - 別アカウントへの AMI 共有: 別の AWS アカウントのアカウント番号を指定して AMI へのアクセス権限を付与して共有する。
  - 別リージョンへの AMI コピー: 同じ AWS アカウントで送信先リージョンを指定して AMI をコピーする。
  - ポイントは同じリージョン同士でないと別アカウント間の共有はできないということ。

- AWS SSO: アクセス権限セットを使用して管理アカウントからユーザーごとのアクセス権限を一元管理する。ID ストア、既存の AWS Active Directory、既存の外部プロバイダーから接続先の ID プロバイダーを通して、IAM ロールに Assume する。

  - ID ストア: ユーザーやグループの格納場所
  - アクセス権限セット: IAM ロールのポリシーを定義。
  - ![Screenshot 2023-02-01 at 7 55 02](https://user-images.githubusercontent.com/61643054/215902469-a1e9cc7e-7ef3-4a52-a048-93adc282e756.png)

- タグ付け:

  - AWS Config でタグ付けの有無を検知し、AWS Systems Manager Automation と組み合わせて自動修復できる。
  - AWS Service Catalog で Tag Option ライブラリを使用することでプロビジョニングされたプロダクトにダグ付けできる。
  - Tag Editor: 複数のリソースへのタグ付けやタグの編集・削除などを一括で行える機能です。
  - コスト配分タグ: AWS 生成のタグとユーザー定義タグを有効化することで、コスト配分レポートや Cost Explorer で可視化できる。
  - Tag Policy: AWS Organizations 内で例えば特定のタグは特定の値のみ許可することにより、大文字小文字の表記揺れや値の設定のばらつきなどを防ぐことができます。

- ALB の加重ターゲットグループ: ターゲットグループに対するトラフィックの重みを変える。

- Amazon Elastic Cache :

  - ElastiCache では最小の構成単位を「ノード」と呼びます。EC2 で言うところのインスタンスに相当するものです。このノードを組み合わせた集合体をクラスターと呼びます。ノードに直接接続してしまうと、もしそのノードに問題が発生した場合には新しいノードのアドレス（エンドポイント）をアプリケーション側で書き換えなくてはなりませんし、サービスの成長と共に負荷が上がってくるとノードの台数を増やして負荷やメモリ（キャッシュ）を分散したりといった要件も出てきます。クラスター構成を組んでおいて、常にアプリケーションはエンドポイントを見ておくようにすればノードの増減によってアプリケーションに変更を行う必要がありません。よって、運用を行う上でこのクラスター機能という観点は非常に大事になってくるのです。
  - for Memcached:
    - マルチスレッド動作
    - Memcached のクラスターは単純にノードを追加したり減らしたりして負荷を分散することができます（水平スケーリング、スケールアウト/イン）。
  - for Redis:
    - マルチ AZ
    - シングルスレッド動作
    - クラスターモードが無効なスケーリング:
      - ノードタイプをサイズの大きいものに変更する垂直スケーリング
      - リードレプリカの追加
    - クラスターモードがモードが有効なスケーリング:
      - シャードを追加する水平スケーリングが可能。
  - シャード：プライマリと呼ばれるノードからレプリカのノードに対してデータをレプリケーションするグループの名前。
  - Eviction: どんどんデータが保存されて行って maxmemory に到達した際、発生する挙動に対する対処法:
    - noeviction: メモリ制限に達し、クライアントがより多くのメモリを使用する可能性のあるコマンドを実行しようとするとエラーを返します。
    - volatile-ttl: 有効期限（TTL）が短いキーから削除してスペースを確保します。
    - volatile-lfu: LRU アルゴリズムに基づき、有効期限（TTL）のあるキーの中で最もアクセスが少ないキーを失効させてスペースを確保します。
    - allkeys-lfu: LRU アルゴリズムに基づき、最もアクセスが少ないキーを失効させてスペースを確保します。
    - volatile-random: 有効期限（TTL）のあるキーをランダムに失効させてスペースを確保します。
    - allkeys-random: ランダムにキーを失効させてスペースを確保します。

- バージョニングが有効になっている S3 Bucket でオブジェクトを削除した後、オブジェクトを取得する方法:

  - 削除マーカーが付与されたオブジェクトは、バージョンのリストに残っているので、削除マーカーを削除することで復旧できる。
  - 以前のバージョンのオブジェクトをリスト表示してダウンロードすることも可能。

- オンプレミスにある web サーバーへの攻撃を AWS サービスを活用して軽減する方法。

  - オンプレミス web サーバーをオリジンに指定できる CloudFront を使用し、AWS WAF を適用することでオンプレミスへの攻撃を軽減する。

- RDS のパラメータグループ: 転送データ暗号化で使用する TLS などのセキュリティプロトコルをはじめ DB 設定に重要なパラメータを管理している。
- NLB: 自動割り当ての静的 IP アドレスまたは Elastic IP アドレスを割り当てることができる。

- AWS Organizations 内のメンバーアカウントの CloudTrail 証跡ログを管理アカウントで一元管理する手段:

  - すべての機能を有効化した上で管理アカウントで組織の証跡を作成することで S3 bucket に CloudTrail 証跡が残る。

- AWS Direct Connect Gateway: AWS Direct Connect で作成したプライベート仮想インターフェイスを接続することで、複数リージョンの VPC に接続することができる。

  - ![Screenshot 2023-02-07 at 7 45 32](https://user-images.githubusercontent.com/61643054/217104887-408fdae6-6f7c-41e9-b767-17c3ec6a0f39.png)

- IAM ポリシー:

  - Sid: ステートメント ID でポリシー内で一意となる任意の文字列を追加する。
  - 「bucke_name/\*」ではバケット配下のフォルダおよびオブジェクトが対象。
  - ListBucket オプションで指定する場合は「bucket_name」のみとなる。

- オンプレミスのディレクトリサービスと連携して、AWS マネジメントコンソールへのアクセス権を付与するパターン

  - AD Connector または AWS Managed Microsoft AD を管理する AWS Directory Service で AWS マネジメントコンソールアクセスを有効にする。
  - AD Connector または AWS Managed Microsoft AD と接続する AWS SSO で AWS マネジメントコンソールアクセスを設定する。
  - OpenID Connect または SAML2.0 を提供する IdP との ID フェデレーションを IAM の ID プロバイダー・IAM ロールで設定する。
  - IAM の ID プロバイダー以外の外部サービス(IdP などを介して連携した Amazon Cognito ID プールやカスタム ID ブローカーなど)で認証し、認証後に発行する IAM STS で AWS マネジメントコンソールへのフェデレーションログイン用 URL を発行する。

- 1Gbps の回線で 1 日に移行できるデータ量が約 10TB
- AWS Snowcone: 使用可能な 8TB の HDD と 14TB の SSD ストレージを持つ。
- AWS Snowball Edge Storage Optimized: 使用可能な 80TB の HDD と 1TB の SSD ストレージを持つ。
- AWS Snowball Edge Compute Optimized: 使用可能な 42TB の HDD と 7.68TB の SSD ストレージを持つ。
- AWS Snowmobile: 使用可能な 100PB の HDD ストレージを持つ。
