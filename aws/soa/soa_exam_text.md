# soa試験テキスト

## モニタリング、ロギング、修復
- ワークロード: AWS上に構築されたシステム。
- メトリクス: AWSリソースの使用状況を収集し、数値化された時系列データセットのこと。
- CloudWatch: メトリクスのリポジトリ。
- CloudWatchエージェント: アプリケーションごとのメモリ使用率など、OSの内部で取得する必要のあるデータをカスタムメトリクスとしてCloudWatchに収集する。
- CloudWatch Logs: ログの一元管理・検索・フィルター処理を行うサービス。
- AWS Config: AWSリソースの設置を記録して評価するサービス。
    - AWS Config ルール: AWSリソースの設定内容をチェックして、修復アクションの実行(AWS Systems Manager Automation)、SNSによる通知を行う。

## 信頼性とビジネス継続性

- 信頼性: 障害に対して回避・維持・回復する能力。

- Auto Scaling: ターゲットに対してスケーリングを行うことが目的。
    - 手動スケーリング
    - スケジュールスケーリング
    - 動的スケーリング:
        - 簡易スケーリング: CPU使用率が50%を超えるとEC2インスタンスを1つ追加するなど。実行できることも少ないため、非推奨。
        - ステップスケーリング: CPU使用率が60~70%ならEC2インスタンスを1つ追加、70~80%ならEC2インスタンスを2つ追加など。
        - ターゲット追跡スケーリング: CPU使用率50%が目標値とすると、スケーリンググループ全体のCPU使用率が50%になるように自動的にスケールアウト/スケールインの調整がされる。
    - 予測スケーリング: 過去のCloudWatchのメトリクスを機械学習させてシステム負荷の動向を推測し、そのパターンに応じてスケーリングを行う。
    - スケーリング対象:
        - Amazon EC2 Auto Scaling Group
        - Amazon EC2 スポットフリートリクエスト
        - Amazon ECS
        - Amazon DynamoDB
        - Amazon Aurora
    - Auto Scaling Group: スケーリングに関するインスタンスを管理する論理的なグループ。インスタンス数の最小・最大・希望の台などを指定できる。
    - 起動テンプレート: Auto Scaling Groupでスケールアウトが発生し、新たにインスタンスを作成するときの事前の設定。
- ELB: ターゲット(EC2、コンテナ、IPアドレス)のトラフィックを自動分散させる負荷分散サービス。単一リージョンのサービス。
    - ロードバランサー: 一意なFQDN(Fully Qualified Domain Name)を使って接続し、プロトコルとポートごとに各リスナーに振り分け。
    - リスナー: プロトコルとポート、ルールごとに振り分け。
    - ターゲットグループ: ターゲットとヘルスチェックを管理。
    - ヘルスチェック: ターゲットに対して設定したプロトコルでアクセスを行い正常にアクセスできるかをテストする操作。合格したインスタンスのみにリクエストがルーティングされる。
    - ALB: ターゲットへの通信はALB自身が行うため、ターゲットから見た接続元IPはALBになる。接続したユーザーのIPを確認したい場合は、X-Forwarded-For HTTPヘッダーに接続元IPが記録されているので、これをターゲット側で出力するようにする。また、ALB自身にセキュリティグループを設定し、ターゲットのセキュリティグループにALBのセキュリティグループを設定するとターゲットへの接続をALBのみに制限し、外部から直接接続できなくする。
- NLB: UDPを扱うシステムや静的IPでアクセスをしたい場合に最適。

- Route53のヘルスチェック: システムのエンドポイントに対するヘルスチェック。複数のリージョンにあるシステムに対して可能。

- RDS: スタンバイレプリカとリードレプリカがある。
- Aurora: リードレプリカのみ。
- SQSのスケーリング: SQSのqueue数などをlambdaでget metricsで取得し、cloudwatchにput metricsする。cloud watchアラームによってAuto ScalingでEC2インスタンスをスケールアウトできる。
- 可用性: システムが使用できる状態を維持できる能力。
- 耐障害性: 障害が起きていてもシステムを維持できる能力。

- EC2のマルチAZ化: Auto Scaling Groupでネットワーク設定で複数のAZを指定。
- ELBのマルチAZ化: ALBの場合は稼働させるAZを2つ以上選択することによりマルチAZ構成となる。
- RDSのマルチAZ化: マルチAZ設定を行うと別のAZにRDS スタンバイインスタンスが構築される。

- フォールトトレラント: コンポーネントの一部が故障してもシステムがパフォーマンスを落とすことなく動作し続ける能力。

- Route53のルーティングポリシー: DNSの応答をカスタマイズすることでクライアントからのトラフィックを適したリソースへルーティングする機能。
    - シンプルルーティング: 1つのリソースに複数のIPアドレスを設定可能。
    - 加重ルーティングポリシー: ドメインに対して複数のリソースを関連付けることができ、割合を決めることができる。
    - フェイルオーバールーティングポリシー: Route53のヘルスチェックによりリソースが正常なほうへトラフィックをルーティング。
    - レイテンシールーティングポリシー: ネットワークレイテンシーが最も低いAWSリージョンに基づいてリクエストをルーティングできる。

- RPO(Recovery Point Objective): 障害が発生した時にどの地点までのデータを復旧させるかの目標。 例えばRPOが1日であれば毎日1回Backupを取得する。
- RTO(Recovery Time Objective): 障害発生時からどのくらいの時間でシステムを復旧させるかの目標。

- RDSスナップショット:
    - 自動スナップショット: 1日1回スナップショット、5分に1回トランザクションログを出力。
- AWS Backup: 様々なAWSリソースのbackupリストを一元管理できるサービス。個々のサービスで行っていたbackup、リストアの操作をまとめて管理できるようにしたもの。
    - EC2
    - DynamoDB
    - EBS
    - S3
    - RDS
    - Storage gatewa
    - EFS
- AWS Backup Audit Manager: 全ての対象のリソースで毎日Backupができているか、そのBackupが暗号化されているかなどを確認できる。
- AWS Data Lificycle Manager(DLM): EBSスナップショットとAMIの作成、保持、削除を自動化できる。backupに失敗した時に、設定した世代管理の数だけ直近のbackupが残るが、明確に世代管理する必要がない場合は。AWS Backupで良い。
- データベースのリストア:
    - ポイントインタイムリストア: スナップショットと5分に1回のトランザクションログからリストア
    - リードレプリカの昇格: 5分以上で、あれば瞬時にリストアできるリードレプリカの昇格を選択する。

- S3:
    - アクセスする側の権限: IAMポリシー
    - アクセスされる側の権限: Bucket Policy, ACL
        - Bucket Policy: バケット単位でアクセス制限したい場合やクロスアカウントでの利用
        - ACL: Bucket Policyより弱い権限で、Bucket Policyが優先される。

## 展開、プロビジョニング、	オートメーション

- プロビジョニング: AWSの各種リソースの構築。
- AMI (Amazon Machine Image): ソフトウェア構成をイメージファイルとしてまとめることができる。サーバーのディスクであるEBSに格納されるデータや構成情報も含まれている。

- AWS CloudFormation:
    - スタック: テンプレートファイルから作成されるリソースの集合。
    - 変更セット: CloudFormationの実行により理教を受けるリソースを事前に確認する機能。
    - ドリフト: コンソールとスタック リソースの差分を検出する機能。
- AWS CDK(AWS Cloud Development Kit): cfnテンプレートをTypeScript, Java, Pythonなどのプログラミング言語から生成することができる。

- Blue/Greenデプロイ: 新旧バージョンのアプリケーションを並存させ、ロードバランサーなどの機能でトラフィックを旧から新に切り替えること。

##  セキュリティとコンプライアンス

- IAMポリシー: AWSリソースへのアクセス権限をまとめたもの
    - Action: どのサービスの
    - Resource: どういう機能や範囲を
    - Effect: 許可または拒否

- GuardDuty: CloudTrail, VPCフローログ, DNSログの3種類から悪意のあるログやIPや異常パターンなどを検出する。
- Amazon Detective: CloudTrail, VPCフローログ, GuardDutyの情報を受け取り分析する。Guard Dutyで発見した問題の兆候をさらに詳細に深掘りする用途などで使う。

- SCP(Service Control Policy): AWSアカウントに対するポリシーという形でホワイトリスト/ブラックリスト形式で権限を管理する。上位で決めたポリシーは個々のアカウント単位で打ち消すことはできません。

- SAML2.0を使用したフェデレーション: 
    - 外部の認証機関を利用してAWSリソースにアクセス許可を与える方法としてSAML2.0を利用したフェデレーションがある。
    - SAML(Sercurity Assertion Markup Language)は複数の独立したシステムの間で認証要求や認証の可否の情報をやり取りするための仕様。
    - 外部の認証機関を利用する利点としては、組織内の認証管理の一元化ができることです。
    - Active Directoryのような組織内の認証を一手に担うIDプロバイダーを用意することで、組織・利用者の認証に関する管理負荷を下げることができます。
    - AWSアカウントに対してSAML2.0を使用したフェデレーション設定をする場合はIAMロールのプリンシパルの設定でSAMLプロバイダーとの信頼関係を設定する。
- AWS Directory Service:
    - Simple AD: Samba4を使用したMicrosoft Active Directory互換のディレクトリサービス。
    - AD Connector: Active Directoryに対するプロキシのようなサービスで、オンプレミス上に構築済みのADがある場合にAD Connectorを経由して認証することができる。
    - AWS Manged Microsoft AD: Active Directoryそのものを構築。
- Amazon Macie: 機械学習によるデータ分類、識別の自動化サービス。

- AWS Key Management Serivce(KMS): 暗号化キーの作成と管理を行うマネージドサービス。
    - エンベロープ暗号化: 暗号化の為に使用するキーをさらに別のキーで暗号化する仕組み。
    - Customer Data Key (CDK): 暗号化のために使用するキー。
    - Customer Master Key(CMK): CDKを暗号化するキー。

- ストレージの種類:
    - S3(オブジェクトストレージ): ファイルをオブジェクトとしてフラットな形式で保存する。
    - EBS(ブロックストレージ): データをブロック単位で分割して保存。サーバーのハードディスクなどに利用。
    - EFS(ファイルストレージ): ディレクトリとファイル構造を持つ形式でファイルを保存する。

- S3の暗号化:
    - サーバーサイド暗号化: S3にデータが到達した後、S3側でデータの暗号化を行う方法。
        - Amason S3キー(SSE-S3)
        - AWS KMSキー(SSE-KMS)
        - ユーザーが指定したキー(SSE-C): コンソールからは利用できず、AWS CLI, AWS SDKまたはS3 RESTAPIを使用する必要がある。
    - クライアントサイド暗号化: クライアント側でデータを暗号化してS3にアップロードする方法。
- EBSの暗号化: EBSボリュームとスナップショットのいずれも暗号化が可能。デフォルトの暗号化を強制することができる。
- EFSの暗号化: ファイルシステム作成時に暗号化するか選択できる。デフォルト暗号化の強制も可能。
- RDSの暗号化: インスタンスを新規作成する時のみ暗号化の設定が可能。
- ACM(AWS Certificate Manager): SSL/TLSで用いる証明書の発行と管理を行うマネージドサービス。
    - ELB: ELBに証明書を適用することで外部からのアクセスをSSL/TLSで暗号化することができる。
    - Amazon CloudFront: ディストリビューションに証明書を適用することで、CloudFrontで配信されるコンテンツへのアクセスを暗号化する。

- AWS VPN(Virtual Private Network): インターネットを利用して仮想のプライベートネットワークを構築する技術。
    - AWS Site-to-Site VPN: オンプレミスとAWSの拠点間ネットワークをIPsecおよびVPN接続する仕組み。オンプレミス側にVPN接続のための機器(カスタマーゲートウェイ)を用意する必要がある。社内ネットワークとAWSを接続したい場合などに利用。
    - AWSクライアントVPN: AWSのネットワークやリソースに対して、各クライアントからTLS VPNセッションにより接続する仕組み。
        - 例えばリモートワークのようなケースで、社員が利用する端末にVPNクライアントとなるソフトをインストールすることで、各端末からのVPN接続が可能になる。
- Amazon Inspector: EC2インスタンスの脆弱性を評価および検出するサービス。Amazon InspectorエージェントをEC2インスタンスにインストールすることでEC2の評価が可能。
    
- AWS Security Hub: AWSアカウントにおけるセキュリティの状態と、セキュリティのベストプラクティスに準拠しているかどうかを包括的に把握する機能を提供。

## ネットワークとコンテンツ配信
