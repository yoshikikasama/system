# CloudLicence

## 51.

- Trusted Advisor の公開キー CloudWatch 　イベントモニター:

  - ![image](https://github.com/yoshikikasama/system/assets/61643054/0cb9443c-21f3-467b-afc8-8e97bf2ef322)
  - 1AM アクセス キーは、Trusted Advisor によって監視されている一般的なコード リポジトリ（例：github）の 1 つに誤ってアップロードされます。
  - Trusted Advisor はキーを検出し、Trusted Advisor の公開アクセス キー CloudWatch イベントを生成します。AWS はまた、キーが実行できる API 呼び出しを一時的に制限します。
  - 3.Exposedkey 設定された CloudWatch イベント ルールがこのイベントと一致し、次のサブステップを持つ Step Functions ステートマシンの実行をトリガーします。
    - 公開された IAM アクセス キー ペアを削除する
    - CloudTrail からのユーザーの最近の API アクティビティの概要
    - 概要を含むセキュリティ通知メッセージを SecurityNotificationTopicSNS トピックに送信します。

## 52.

- Amazon AWS Health によるイベントのモニタリング EventBridge: 作成したルールに基づいて、イベントがルールで指定した値と一致したときに 1 EventBridge つ以上のターゲットアクションを呼び出します。イベントのタイプに応じて、イベント情報の取得、追加イベントの開始、通知の送信、是正措置の実施、またはその他のアクションを実行することができます。たとえば、Amazon Elastic Compute Cloud (Amazon EC2) インスタンスなど、 AWS AWS アカウント 更新が予定されているリソースがにある場合に、を使用して AWS Health E メール通知を受け取ることができます。

- Amazon EC2 Auto Scaling では異常なインスタンスをデバッグする際にインスタンスをスタンバイ状態にすることが推奨される。スタンバイ状態にすることでインスタンスが終了されない。

- AWS Config：マルチアカウントマルチリージョンのデータ集約

  - AWS Config アグリゲータ は、すべてのアカウントから AWS Config の設定とコンプライアンスデータを収集するのに役立ちます。このデータの収集により、IAM ポリシーの準拠を一元的に確認することができる
  - AWS Config はリソースの設定変更を記録し、IAM ポリシーの準拠を継続的に評価します。そのため、すべてのアカウントに AWS Config ルールをデプロイすることで、組織全体の IAM ポリシーの準拠を継続的に確認し、適宜修正することができる

  ## 53.

- ![image](https://github.com/yoshikikasama/system/assets/61643054/c4d38a52-2024-4761-b7a5-9fec157a78ae)

  - Route 53 エイリアスレコードとヘルスチェック
    - Route 53 ヘルスチェック: Route 53 を使用してプライマリリージョンの ALB のヘルスチェックを行います。ヘルスチェックが失敗した場合、トラフィックを災害復旧リージョンにリダイレクトします
    - ALB は EC2 インスタンスのヘルスチェックを行い、不健全なインスタンスがあればそのインスタンスへのトラフィックを停止します。
    - Route 53 は ALB のヘルスチェックを行い、ALB 全体が不健全と判断された場合、トラフィックを災害復旧リージョンにリダイレクトします。
  - ALB と Auto Scaling グループ
    - Primary Region (us-east-1): プライマリリージョンには、Application Load Balancer (ALB) と Auto Scaling グループが設定されており、複数のアベイラビリティーゾーンにまたがってアプリケーションを実行します。
    - Disaster Recovery Region (例: us-west-2): 災害復旧リージョンにも同様に ALB と Auto Scaling グループを設定します。この構成はプライマリリージョンの障害時に迅速に切り替えられます。
  - RDS インスタンスとリードレプリカ
    - プライマリリージョンの RDS (Multi-AZ): データベースはプライマリリージョンにマルチ AZ 配置で設定されています。
    - 災害復旧リージョンの RDS リードレプリカ: 災害復旧リージョンにはリードレプリカを設定します。プライマリリージョンで障害が発生した場合、AWS Lambda と CloudWatch Events を使用してリードレプリカをマスターに昇格させます。

- AWS CloudFormation を使用して EC2 インスタンスを起動し、PHP アプリケーションを提供するために Nginx と PHP-FPM をインストールするシナリオについてのものです。ここでの課題は、インスタンスのソフトウェアインストールが完了する前に CloudFormation がスタック作成を完了してしまうことを防ぐことです。そのために、CreationPolicy 属性と cfn-signal ヘルパースクリプトを使用する方法について説明しています。

  - CreationPolicy 属性
    - CreationPolicy 属性を使用することで、リソースが完全にセットアップされるまで CloudFormation がスタックの作成を完了しないようにできます。具体的には、指定された数のシグナルを受信するまでリソースのステータスが CREATE_COMPLETE になりません。
  - cfn-signal ヘルパースクリプト

    - cfn-signal ヘルパースクリプトを使用して、EC2 インスタンスが起動し、必要なソフトウェア（Nginx と PHP-FPM）がインストールされ、設定が完了したことを CloudFormation に通知します。このスクリプトは、インスタンス上のユーザーデータスクリプト内で呼び出されます。

  - ```Resources:
    MyEC2Instance:
      Type: "AWS::EC2::Instance"
      Properties:
        ImageId: "ami-0abcdef1234567890" # 適切なAMI IDに置き換えてください
        InstanceType: "t2.micro"
        KeyName: "my-key-pair"
        UserData:
          Fn::Base64: |
            #!/bin/bash
            yum update -y
            yum install -y nginx php-fpm
            systemctl start nginx
            systemctl enable nginx
            systemctl start php-fpm
            systemctl enable php-fpm
            /opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource MyEC2Instance --region ${AWS::Region}
      CreationPolicy:
        ResourceSignal:
          Count: 1
          Timeout: PT15M
    ```

- あなたは大規模な組織で働く DevOps エンジニアです。会社は AWS CloudFormation を使ってインフラストラクチャを構築し始めたいと考えています。ネットワーク、セキュリティ、アプリケーションなど、さまざまな部門からテンプレートに対する要件が寄せられています。

  - 個別の論理テンプレート、例えばネットワーク、セキュリティ、アプリケーションなどの個別のテンプレートを作成し、それらをネストして使用することが推奨されます。
  - ```Resources:
    NetworkStack:
      Type: "AWS::CloudFormation::Stack"
      Properties:
        TemplateURL: "https://s3.amazonaws.com/mybucket/network.yaml"
    ```

- 企業が災害復旧時に AWS のセカンダリリージョンで開発を継続できるようにするためのソリューションについてです。具体的には、AWS CodeCommit のリポジトリをプライマリリージョンからセカンダリリージョンにミラーリングする方法:
  - AWS CodeBuild: Git ミラー操作を実行するためのビルドプロジェクト。
    - ```
        phases:
          build:
            commands:
              - git clone --mirror https://git-codecommit.${AWS_REGION}.amazonaws.com/v1/repos/primary-repo
              - cd primary-repo.git
              - git push --mirror https://git-codecommit.${SECONDARY_AWS_REGION}.amazonaws.com/v1/repos/secondary-repo
      ```
  - Amazon EventBridge: プライマリリージョンの CodeCommit リポジトリでマージイベントが発生したときにトリガーするルール。
  - AWS Lambda: EventBridge ルールがトリガーされたときに CodeBuild プロジェクトを起動する関数。
  - ![image](https://github.com/yoshikikasama/system/assets/61643054/29b638f7-7f4f-4bf8-bf9f-4ea1fdd8e540)

## 54.

- AWS Elastic Beanstalk 環境で非同期タスクを効率的に処理し、ウェブサーバーの負荷を軽減するためのソリューション:

  - AWS Elastic Beanstalk ワーカー環境: 非同期タスクや定期タスクの処理を行うための環境。
  - Amazon SQS キュー: ワーカー環境がタスクを取得するために使用するキュー。
  - cron.yaml: 定期的なタスクをスケジュールするための設定ファイル。
  - ![image](https://github.com/yoshikikasama/system/assets/61643054/be745ca8-ac2a-44eb-976f-f0649a2c9e88)

- アプリケーションは、Auto Scaling グループで動作する Amazon EC2 インスタンス上にデプロイされます。ブートストラッププロセス中に、インスタンスはプライベート IP アドレスを監視システムに登録します。監視システムは、これらの IP アドレスに ping リクエストを送信し、インスタンスが応答しなくなった場合にアラートを送することで、ヘルスチェックを頻繁に実行します。既存のデプロイ戦略は、現在の EC2 インスタンスを新しいものに置き換えます。DevOps エンジニアは、監視システムがデプロイ中に誤ったアラームを送信していることに気づき、これらの誤ったアラームを停止することを課題としています。
  - インスタンス終了時にライフサイクルフックを使用して EventBridge が AWS Lambda 関数を呼び出し、監視システムから終了したインスタンスの IP アドレスを削除します。
