# CloudLicence

## 71.

- ある開発チームでは、CodeDeploy による Blue/Green デプロイを使用してウェブサイトのデプロイを管理します。アプリケーションは、Auto Scaling グループの Application Load Balancer の背後にある Amazon EC2 インスタンスで実行されています。
  新しいリビジョンをデプロイするとき、チームはデプロイが最終的に失敗することに気づきましたが、失敗するまでに長い時間がかかります。さらに開査したところ、AllowTraffic ライフサイクルイベントが 1 時間実行され、最終的に他の情報を提供することなく失敗したことが分かりました。チームは、障害が発生した場合でもアプリケーションの可用性を維持しながら、障害通知がより迅速に配備されるようにしたいと考えています。
  これらの要件を満たすための最適な方法の組み合わせを選択してください。

  - デプロイ失敗イベント用の CodeDeploy トリガーを作成する
    - CodeDeploy トリガーを使用すると、デプロイが失敗したときに通知を受け取ることができます。これにより、単一のヘルスチェックが失敗した場合でも即座にデプロイを失敗と判断し、迅速に通知を受け取ることができます。これにより、問題が発生した際にすぐに対応でき、アプリケーションの可用性を維持するのに役立ちます。
  - appspec.yml ファイルを使用して BeforeAllowTraffic フックでスクリプトを実行する
    - BeforeAllowTraffic フックを使用することで、アプリケーションがトラフィックを受け入れる前にヘルスチェックを実行できます。ヘルスチェックに失敗した場合はデプロイを即座に停止させることができます。これにより、問題のあるバージョンがユーザーに影響を与える前にデプロイを中止でき、アプリケーションの安定性を保つことができます。

- 企業の要件
  - トラフィックが一定しないステートレスなウェブアプリケーション: 時間や状況によってアクセス量が変わるアプリケーション。
  - AWS CloudFormation でデプロイ: インフラのコード管理ツールを使用。
  - ALB の背後にある Amazon EC2 インスタンスで実行: 負荷分散機能を利用し、複数の EC2 インスタンスでアプリケーションを実行。
  - 複数のアベイラビリティーゾーンで実行: 高可用性の確保。
  - コスト削減のためにスポットインスタンスを使用したい: スポットインスタンスは、余剰の EC2 インスタンスを割安で利用できるもの。
- スポットフリート: スポットインスタンスとオンデマンドインスタンスの組み合わせを使って、アプリケーションの要件を満たすようにインスタンスを自動的に管理する機能です。スポットインスタンスは安価ですが、AWS の需要に応じて停止されることがあります。そのため、信頼性を保つためにオンデマンドインスタンスと併用することが推奨されます。
  - スポットフリートでは、以下の配分戦略がありますが、最適なものを選ぶ必要があります。
    - lowestPrice: 最も安いスポットインスタンスを選ぶ。
    - diversified: スポットインスタンスを複数のプールに分散させる。
    - capacityOptimized: 最も容量が最適化されたスポットインスタンスプールを選ぶ。capacityOptimized 配分戦略は、リアルタイムの容量データに基づいて最適なスポットインスタンスプールを選びます。これにより、インスタンスの割り当てに失敗するリスクが低減され、コスト効率が向上します。特に、中断がコストのかかるワークロードに適しています。
    - スポットインスタンスのプールは、特定のインスタンスタイプ（例: m4.large）と特定のアベイラビリティーゾーン（例: us-east-1a）の組み合わせのことを指します。つまり、各プールは特定のインスタンスタイプと特定のアベイラビリティーゾーンで構成されています。
      - 例えば、m4.large インスタンスのスポットプールが以下のようにあるとします。
        - m4.large in us-east-1a
        - m4.large in us-east-1b
        - m4.large in us-east-1c
- IT における「プール（pool）」は、特定の目的のためにグループ化されたリソースの集合を意味します。泳ぐためのプールとは異なり、これらのプールはシステムの効率化やリソースの最適化に役立つものです。

- 企業が AWS 環境でのセキュリティ監視を強化し、特に restricted-ssh ルールに準拠していないセキュリティグループに対してリアルタイムでカスタマイズされた通知を受ける方法
  - Amazon SNS トピックの作成:
    - SNS トピックを作成し、通知を受け取る担当者（例えば、セキュリティチームのメールアドレス）をサブスクライブします。
  - AWS Config でルールを設定:
    - AWS Config で restricted-ssh ルールを有効にします。このルールは、セキュリティグループが特定の SSH ポリシーに準拠しているかどうかを監視します。
  - Amazon EventBridge ルールの設定:
    - Amazon EventBridge を使用して、AWS Config の評価結果をフィルタリングし、restricted-ssh ルールのコンプライアンスステータスが NON_COMPLIANT の場合にトリガーするルールを作成します。
  - 入力トランスフォーマーの設定:
    - イベントブリッジで、通知に必要な情報（準拠していないセキュリティグループの名前と ID など）を抽出してカスタマイズするために入力トランスフォーマーを使用します。
  - SNS 通知の設定:
    - EventBridge ルールがトリガーされた際に、カスタマイズされた通知を Amazon SNS トピックに送信するように設定します。

## 72.

- 問題の背景
  - ソフトウェア開発チームは、同じコードブランチを使用して 2 つの異なる環境にデプロイしています。
  - 開発環境：開発者がコードをテストするための環境。
  - UAT 環境：ビジネスユーザーが最終確認を行うための環境。
  - ある日、UAT 環境でビジネスユーザーから不具合が報告されました。しかし、同じコードを実行している開発環境ではその不具合は再現しませんでした。この問題を解決するためには、2 つの環境が同じ構成であることを保証する必要があります。
- 解決方法
  - CloudFormation を使用して環境を構築：
    - AWS CloudFormation は、AWS リソースのセットアップを自動化するツールです。単一のテンプレートを使用して、開発環境と UAT 環境を同じ設定で構築することで、環境の違いによる問題を防ぎます。
    - CloudFormation テンプレートをパイプラインのデプロイステージで使用し、環境をプロビジョニングします。
  - アーティファクトのチェックサムを比較：
    - チェックサムとは、ファイルの整合性を確認するためのデジタル署名のようなものです。
    - AWS CodeBuild を使用してビルドされたアーティファクト（ビルド成果物）の SHA-256 チェックサムを取得します。
    - 例えば、開発環境でビルドされたアーティファクトの SHA-256 チェックサムと UAT 環境でビルドされたアーティファクトの SHA-256 チェックサムを比較します。
    - パイプライン内で Lambda 関数を呼び出して、このチェックサムを比較し、アーティファクトが正しいものであることを確認します。
    - ![image](https://github.com/yoshikikasama/system/assets/61643054/0244b345-5f95-413f-88b6-2dacefa93f52)

